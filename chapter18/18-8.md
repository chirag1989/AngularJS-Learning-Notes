<h2 style=" border-bottom: 1px solid #69ab01; color: #5e9802; padding: 2px; text-shadow: 1px 1px 1px gray; margin: 20px auto; font-size: medium;">18.8. 指令定义时的参数</h2>

<p style="margin: 15px 0;">
指令定义时的参数如下：
</p>

<ul style="line-height: 1.4em; padding: 0px; padding-left: 20px; margin: auto 30px;">
<li>name
</li>
<li>priority
</li>
<li>terminal
</li>
<li>scope
</li>
<li>controller
</li>
<li>require
</li>
<li>restrict
</li>
<li>template
</li>
<li>templateUrl
</li>
<li>replace
</li>
<li>transclude
</li>
<li>compile
</li>
<li>link
</li>
</ul>

<p style="margin: 15px 0;">
现在我们开始一个一个地吃掉它们……，但是并不是按顺序讲的。
</p>

<dl style="font-size: small; margin: 10px auto; padding: 10px; border-bottom: 1px dashed gray; border-top: 1px dashed gray;">
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">priority</i></dt><dd style="margin-left: 30px;">
    这个值设置指令的权重，默认是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">0</code> 。当一个节点中有多个指令存在时，就按着权限从大到小的顺序依次执行它们的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">compile</code> 函数。相同权重顺序不定。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">terminal</i></dt><dd style="margin-left: 30px;">
    是否以当前指令的权重为结束界限。如果这值设置为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> ，则节点中权重小于当前指令的其它指令不会被执行。相同权重的会执行。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">restrict</i></dt><dd style="margin-left: 30px;">
    指令可以以哪些方式被使用，可以同时定义多种方式。
    <ul style="line-height: 1.4em; padding: 0px; padding-left: 20px; margin: auto 30px;">
    <li>E 元素方式 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">&lt;my-directive&gt;&lt;/my-directive&gt;</code>
    </li>
    <li>A 属性方式 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">&lt;div my-directive="exp"&gt; &lt;/div&gt;</code>
    </li>
    <li>C 类方式 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">&lt;div class="my-directive: exp;"&gt;&lt;/div&gt;</code>
    </li>
    <li>M 注释方式 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">&lt;!-- directive: my-directive exp --&gt;</code>
    </li>
    </ul>
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">transclude</i></dt><dd style="margin-left: 30px;">
    前面已经讲过基本的用法了。可以是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">'element'</code> 或 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 两种值。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">compile</i></dt><dd style="margin-left: 30px;">
    基本的定义函数。 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">function compile(tElement, tAttrs, transclude) { ... }</code>
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">link</i></dt><dd style="margin-left: 30px;">
    前面介绍过了。大多数时候我们不需要单独定义它。只有 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">compile</code> 未定义时 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 才会被尝试。 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">function link(scope, iElement, iAttrs, controller) { ... }</code>
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">scope</i></dt><dd style="margin-left: 30px;">
    scope 的形式。 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">false</code> 节点的 scope ， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 继承创建一个新的 scope ， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">{}</code> 不继承创建一个新的隔离 scope 。 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">{@attr: '引用节点属性', =attr: '把节点属性值引用成scope属性值', &amp;attr: '把节点属性值包装成函数'}</code>
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">controller</i></dt><dd style="margin-left: 30px;">
    为指令定义一个 controller ， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">function controller($scope, $element, $attrs, $transclude) { ... }</code>
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">name</i></dt><dd style="margin-left: 30px;">
    指令的 controller 的名字，方便其它指令引用。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">require</i></dt><dd style="margin-left: 30px;">
    要引用的其它指令 conroller 的名字， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">?name</code> 忽略不存在的错误， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">^name</code> 在父级查找。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">template</i></dt><dd style="margin-left: 30px;">
    模板内容。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">templateUrl</i></dt><dd style="margin-left: 30px;">
    从指定地址获取模板内容。
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">replace</i></dt><dd style="margin-left: 30px;">
    是否使用模板内容替换掉整个节点， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 替换整个节点， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">false</code> 替换节点内容。
</dd>
</dl>


<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;a</span> <span style="color: #e0eee0">b&gt;&lt;/a&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
    <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
      <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;a&#39;</span>);
    }
  
    <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
            <span style="color: #e0eee0">priority</span><span style="color: #7fff00">:</span> <span style="color: #00ffff">1</span>,
            <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;EA&#39;</span>};
  });
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;b&#39;</span>, <span style="color: #bcd2ee">function</span>(){
    <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
      <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;b&#39;</span>);
    }
  
    <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
            <span style="color: #e0eee0">priority</span><span style="color: #7fff00">:</span> <span style="color: #00ffff">2</span>,
            <span style="color: #507080">//terminal: true,</span>
            <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
  });
</pre></div>


<p style="margin: 15px 0;">
上面几个参数值都是比较简单且容易理想的。
</p>
<p style="margin: 15px 0;">
再看 <i style=" color: #d75100; font-style: normal; ">scope</i> 这个参数：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">ng-controller=</span><span style="color: #00e5ee">&quot;TestCtrl&quot;</span><span style="color: #e0eee0">&gt;</span>
    <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">a</span> <span style="color: #e0eee0">b&gt;&lt;/div&gt;</span>
  <span style="color: #e0eee0">&lt;/div&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;"><span style="color: gray; padding: 0 5px 0 5px"> 1</span>   <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 2</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 3</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 4</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
<span style="color: gray; padding: 0 5px 0 5px"> 5</span>       <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">scope</span>){
<span style="color: gray; padding: 0 5px 0 5px"> 6</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 7</span>       }
<span style="color: gray; padding: 0 5px 0 5px"> 8</span>     }
<span style="color: gray; padding: 0 5px 0 5px"> 9</span>   
<span style="color: gray; padding: 0 5px 0 5px">10</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">11</span>             <span style="color: #e0eee0">scope</span><span style="color: #7fff00">:</span> <span style="color: #90ee90">true</span>,
<span style="color: gray; padding: 0 5px 0 5px">12</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
<span style="color: gray; padding: 0 5px 0 5px">13</span>   });
<span style="color: gray; padding: 0 5px 0 5px">14</span>   
<span style="color: gray; padding: 0 5px 0 5px">15</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;b&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px">16</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
<span style="color: gray; padding: 0 5px 0 5px">17</span>       <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">scope</span>){
<span style="color: gray; padding: 0 5px 0 5px">18</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
<span style="color: gray; padding: 0 5px 0 5px">19</span>       }
<span style="color: gray; padding: 0 5px 0 5px">20</span>     }
<span style="color: gray; padding: 0 5px 0 5px">21</span>   
<span style="color: gray; padding: 0 5px 0 5px">22</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">23</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
<span style="color: gray; padding: 0 5px 0 5px">24</span>   });
<span style="color: gray; padding: 0 5px 0 5px">25</span>   
<span style="color: gray; padding: 0 5px 0 5px">26</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">controller</span>(<span style="color: #00e5ee">&#39;TestCtrl&#39;</span>, <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){
<span style="color: gray; padding: 0 5px 0 5px">27</span>     <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">a</span> <span style="color: #7fff00">=</span> <span style="color: #00e5ee">&#39;123&#39;</span>;
<span style="color: gray; padding: 0 5px 0 5px">28</span>     <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$scope</span>);
<span style="color: gray; padding: 0 5px 0 5px">29</span>   });
</pre></div>


<p style="margin: 15px 0;">
对于 <i style=" color: #d75100; font-style: normal; ">scope</i> ：
</p>

<ul style="line-height: 1.4em; padding: 0px; padding-left: 20px; margin: auto 30px;">
<li>默认为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">false</code> ， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数接受的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 为节点所在的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 。
</li>
<li>为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 时，则 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数中第一个参数（还有 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">controller</code> 参数中的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">$scope</code> ）， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 是节点所在的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">child scope</code> ，并且如果节点中有多个指令，则只要其中一个指令是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 的设置，其它所有指令都会受影响。
</li>
</ul>

<p style="margin: 15px 0;">
这个参数还有其它取值。当其为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">{}</code> 时，则 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 接受一个完全隔离（isolate）的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> ，于 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 的区别就是不会继承其它 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 的属性。但是这时，这个 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 的属性却可以有很灵活的定义方式：
</p>
<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">@attr</i> 引用节点的属性。
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">ng-controller=</span><span style="color: #00e5ee">&quot;TestCtrl&quot;</span><span style="color: #e0eee0">&gt;</span>
    <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">a</span> <span style="color: #e0eee0">abc=</span><span style="color: #00e5ee">&quot;here&quot;</span> <span style="color: #e0eee0">xx=</span><span style="color: #00e5ee">&quot;{{ a }}&quot;</span> <span style="color: #e0eee0">c=</span><span style="color: #00e5ee">&quot;ccc&quot;</span><span style="color: #e0eee0">&gt;&lt;/div&gt;</span>
  <span style="color: #e0eee0">&lt;/div&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
    <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
      <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">scope</span>){
        <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
      }
    }
  
    <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
            <span style="color: #e0eee0">scope</span><span style="color: #7fff00">:</span> {<span style="color: #e0eee0">a</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;@abc&#39;</span>, <span style="color: #e0eee0">b</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;@xx&#39;</span>, <span style="color: #e0eee0">c</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;@&#39;</span>},
            <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
  });
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">controller</span>(<span style="color: #00e5ee">&#39;TestCtrl&#39;</span>, <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){
    <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">a</span> <span style="color: #7fff00">=</span> <span style="color: #00e5ee">&#39;123&#39;</span>;
  });
</pre></div>


<ul style="line-height: 1.4em; padding: 0px; padding-left: 20px; margin: auto 30px;">
<li><i style=" color: #d75100; font-style: normal; ">@abc</i> 引用 div 节点的 abc 属性。
</li>
<li><i style=" color: #d75100; font-style: normal; ">@xx</i> 引用 div 节点的 xx 属性，而 xx 属性又是一个变量绑定，于是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 中 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">b</code> 属性值就和 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">a</code> 变量绑定在一起了。
</li>
<li><i style=" color: #d75100; font-style: normal; ">@</i> 没有写 attr name ，则默认取自己的值，这里是取 div 的 c 属性。
</li>
</ul>

<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">=attr</i> 相似，只是它把节点的属性值当成节点 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 的属性名来使用，作用相当于上面例子中的 <i style=" color: #d75100; font-style: normal; ">@xx</i> ：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">ng-controller=</span><span style="color: #00e5ee">&quot;TestCtrl&quot;</span><span style="color: #e0eee0">&gt;</span>
    <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">a</span> <span style="color: #e0eee0">abc=</span><span style="color: #00e5ee">&quot;here&quot;</span><span style="color: #e0eee0">&gt;&lt;/div&gt;</span>
  <span style="color: #e0eee0">&lt;/div&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
    <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
      <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">scope</span>){
        <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
      }
    }
  
    <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
            <span style="color: #e0eee0">scope</span><span style="color: #7fff00">:</span> {<span style="color: #e0eee0">a</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;=abc&#39;</span>},
            <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
  });
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">controller</span>(<span style="color: #00e5ee">&#39;TestCtrl&#39;</span>, <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){
    <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">here</span> <span style="color: #7fff00">=</span> <span style="color: #00e5ee">&#39;123&#39;</span>;
  });
</pre></div>


<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">&amp;attr</i> 是包装一个函数出来，这个函数以节点所在的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 为上下文。来看一个很爽的例子：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">ng-controller=</span><span style="color: #00e5ee">&quot;TestCtrl&quot;</span><span style="color: #e0eee0">&gt;</span>
    <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">a</span> <span style="color: #e0eee0">abc=</span><span style="color: #00e5ee">&quot;here = here + 1&quot;</span> <span style="color: #e0eee0">ng-click=</span><span style="color: #00e5ee">&quot;show(here)&quot;</span><span style="color: #e0eee0">&gt;</span>这里<span style="color: #e0eee0">&lt;/div&gt;</span>
    <span style="color: #e0eee0">&lt;div&gt;</span>{{ here }}<span style="color: #e0eee0">&lt;/div&gt;</span>
  <span style="color: #e0eee0">&lt;/div&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;"><span style="color: gray; padding: 0 5px 0 5px"> 1</span>   <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 2</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 3</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 4</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">element</span>, <span style="color: #e0eee0">attrs</span>, <span style="color: #e0eee0">link</span>){
<span style="color: gray; padding: 0 5px 0 5px"> 5</span>       <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span> <span style="color: #e0eee0">llink</span>(<span style="color: #e0eee0">scope</span>){
<span style="color: gray; padding: 0 5px 0 5px"> 6</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 7</span>         <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">a</span>();
<span style="color: gray; padding: 0 5px 0 5px"> 8</span>         <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">b</span>();
<span style="color: gray; padding: 0 5px 0 5px"> 9</span>   
<span style="color: gray; padding: 0 5px 0 5px">10</span>         <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">show</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">here</span>){
<span style="color: gray; padding: 0 5px 0 5px">11</span>           <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;Inner, &#39;</span> <span style="color: #7fff00">+</span> <span style="color: #e0eee0">here</span>);
<span style="color: gray; padding: 0 5px 0 5px">12</span>           <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">a</span>({<span style="color: #e0eee0">here</span><span style="color: #7fff00">:</span> <span style="color: #00ffff">5</span>});
<span style="color: gray; padding: 0 5px 0 5px">13</span>         }
<span style="color: gray; padding: 0 5px 0 5px">14</span>       }
<span style="color: gray; padding: 0 5px 0 5px">15</span>     }
<span style="color: gray; padding: 0 5px 0 5px">16</span>   
<span style="color: gray; padding: 0 5px 0 5px">17</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">18</span>             <span style="color: #e0eee0">scope</span><span style="color: #7fff00">:</span> {<span style="color: #e0eee0">a</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;&amp;abc&#39;</span>, <span style="color: #e0eee0">b</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;&amp;ngClick&#39;</span>},
<span style="color: gray; padding: 0 5px 0 5px">19</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>};
<span style="color: gray; padding: 0 5px 0 5px">20</span>   });
<span style="color: gray; padding: 0 5px 0 5px">21</span>   
<span style="color: gray; padding: 0 5px 0 5px">22</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">controller</span>(<span style="color: #00e5ee">&#39;TestCtrl&#39;</span>, <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){
<span style="color: gray; padding: 0 5px 0 5px">23</span>     <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">here</span> <span style="color: #7fff00">=</span> <span style="color: #00ffff">123</span>;
<span style="color: gray; padding: 0 5px 0 5px">24</span>     <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$scope</span>);
<span style="color: gray; padding: 0 5px 0 5px">25</span>   
<span style="color: gray; padding: 0 5px 0 5px">26</span>     <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">show</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">here</span>){
<span style="color: gray; padding: 0 5px 0 5px">27</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">here</span>);
<span style="color: gray; padding: 0 5px 0 5px">28</span>     }
<span style="color: gray; padding: 0 5px 0 5px">29</span>   });
</pre></div>


<p style="margin: 15px 0;">
scope.a 是 <i style=" color: #d75100; font-style: normal; ">&amp;abc</i> ，即：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">a</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">here</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">here</span> <span style="color: #7fff00">+</span> <span style="color: #00ffff">1</span>}
</pre></div>


<p style="margin: 15px 0;">
只是其中的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">here</code> 是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 的。
</p>
<p style="margin: 15px 0;">
scope.b 是 <i style=" color: #d75100; font-style: normal; ">&amp;ngClick</i> ，即：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">scope</span>.<span style="color: #e0eee0">b</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">show</span>(<span style="color: #e0eee0">here</span>)}
</pre></div>


<p style="margin: 15px 0;">
这里的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">show()</code> 和 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">here</code> 都是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 的，于是上面的代码最开始会在终端输出一个 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">124</code> 。
</p>
<p style="margin: 15px 0;">
当点击“这里”时，这时执行的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">show(here)</code> 就是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">llink</code> 中定义的那个函数了，与 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 无关。但是，其间的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope.a({here:5})</code> ，因为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">a</code> 执行时是 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 的上下文，于是向 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">a</code> 传递的一个对象，里面的所有属性 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">TestCtrl</code> 就全收下了，接着执行 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">here=here+1</code> ，于是我们会在屏幕上看到 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">6</code> 。
</p>
<p style="margin: 15px 0;">
这里是一个上下文交错的环境，通过 <i style=" color: #d75100; font-style: normal; ">&amp;</i> 这种机制，让指令的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 与节点的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 发生了互动。真是鬼斧神工的设计。而实现它，只用了几行代码：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #90ee90">case</span> <span style="color: #00e5ee">&#39;&amp;&#39;</span><span style="color: #7fff00">:</span> {
    <span style="color: #e0eee0">parentGet</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">$parse</span>(<span style="color: #e0eee0">attrs</span>[<span style="color: #e0eee0">attrName</span>]);
    <span style="color: #e0eee0">scope</span>[<span style="color: #e0eee0">scopeName</span>] <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">locals</span>) {
      <span style="color: #90ee90">return</span> <span style="color: #e0eee0">parentGet</span>(<span style="color: #e0eee0">parentScope</span>, <span style="color: #e0eee0">locals</span>);
    }
    <span style="color: #90ee90">break</span>;
  }
</pre></div>


<p style="margin: 15px 0;">
再看 <i style=" color: #d75100; font-style: normal; ">controller</i> 这个参数。这个参数的作用是提供一个 controller 的构造函数，它会在 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">compile</code> 函数之后， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数之前被执行。
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;a&gt;</span>haha<span style="color: #e0eee0">&lt;/a&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;"><span style="color: gray; padding: 0 5px 0 5px"> 1</span>   <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 2</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 3</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 4</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 5</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;compile&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 6</span>       <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 7</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;link&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 8</span>       }
<span style="color: gray; padding: 0 5px 0 5px"> 9</span>     }
<span style="color: gray; padding: 0 5px 0 5px">10</span>   
<span style="color: gray; padding: 0 5px 0 5px">11</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">controller</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>, <span style="color: #e0eee0">$element</span>, <span style="color: #e0eee0">$attrs</span>, <span style="color: #e0eee0">$transclude</span>){
<span style="color: gray; padding: 0 5px 0 5px">12</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;controller&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px">13</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$scope</span>);
<span style="color: gray; padding: 0 5px 0 5px">14</span>   
<span style="color: gray; padding: 0 5px 0 5px">15</span>       <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">node</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">$transclude</span>(<span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">clone_element</span>, <span style="color: #e0eee0">scope</span>){
<span style="color: gray; padding: 0 5px 0 5px">16</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">clone_element</span>);
<span style="color: gray; padding: 0 5px 0 5px">17</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;--&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px">18</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">scope</span>);
<span style="color: gray; padding: 0 5px 0 5px">19</span>       });
<span style="color: gray; padding: 0 5px 0 5px">20</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">node</span>);
<span style="color: gray; padding: 0 5px 0 5px">21</span>     }
<span style="color: gray; padding: 0 5px 0 5px">22</span>   
<span style="color: gray; padding: 0 5px 0 5px">23</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">24</span>             <span style="color: #e0eee0">controller</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">controller</span>,
<span style="color: gray; padding: 0 5px 0 5px">25</span>             <span style="color: #e0eee0">transclude</span><span style="color: #7fff00">:</span> <span style="color: #90ee90">true</span>,
<span style="color: gray; padding: 0 5px 0 5px">26</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;E&#39;</span>}
<span style="color: gray; padding: 0 5px 0 5px">27</span>   });
</pre></div>


<p style="margin: 15px 0;">
<code style="margin: auto 3px; color: #228b22; font-family: monospace; ">controller</code> 的最后一个参数， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">$transclude</code> ，是一个只接受 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">cloneAttachFn</code> 作为参数的一个函数。
</p>
<p style="margin: 15px 0;">
按官方的说法，这个机制的设计目的是为了让各个指令之间可以互相通信。参考普通节点的处理方式，这里也是处理指令 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 的合适位置。
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;a</span> <span style="color: #e0eee0">b&gt;</span>kk<span style="color: #e0eee0">&lt;/a&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;"><span style="color: gray; padding: 0 5px 0 5px"> 1</span>   <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 2</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 3</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 4</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 5</span>     }
<span style="color: gray; padding: 0 5px 0 5px"> 6</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 7</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">controller</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>, <span style="color: #e0eee0">$element</span>, <span style="color: #e0eee0">$attrs</span>, <span style="color: #e0eee0">$transclude</span>){
<span style="color: gray; padding: 0 5px 0 5px"> 8</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;a&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 9</span>       <span style="color: #90ee90">this</span>.<span style="color: #e0eee0">a</span> <span style="color: #7fff00">=</span> <span style="color: #00e5ee">&#39;xx&#39;</span>;
<span style="color: gray; padding: 0 5px 0 5px">10</span>     }
<span style="color: gray; padding: 0 5px 0 5px">11</span>   
<span style="color: gray; padding: 0 5px 0 5px">12</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">13</span>             <span style="color: #e0eee0">name</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;not_a&#39;</span>,
<span style="color: gray; padding: 0 5px 0 5px">14</span>             <span style="color: #e0eee0">controller</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">controller</span>,
<span style="color: gray; padding: 0 5px 0 5px">15</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;E&#39;</span>}
<span style="color: gray; padding: 0 5px 0 5px">16</span>   });
<span style="color: gray; padding: 0 5px 0 5px">17</span>   
<span style="color: gray; padding: 0 5px 0 5px">18</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;b&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px">19</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px">20</span>       <span style="color: #90ee90">return</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>, <span style="color: #e0eee0">$element</span>, <span style="color: #e0eee0">$attrs</span>, <span style="color: #e0eee0">$controller</span>){
<span style="color: gray; padding: 0 5px 0 5px">21</span>         <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$controller</span>);
<span style="color: gray; padding: 0 5px 0 5px">22</span>       }
<span style="color: gray; padding: 0 5px 0 5px">23</span>     }
<span style="color: gray; padding: 0 5px 0 5px">24</span>   
<span style="color: gray; padding: 0 5px 0 5px">25</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">controller</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>, <span style="color: #e0eee0">$element</span>, <span style="color: #e0eee0">$attrs</span>, <span style="color: #e0eee0">$transclude</span>){
<span style="color: gray; padding: 0 5px 0 5px">26</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;b&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px">27</span>     }
<span style="color: gray; padding: 0 5px 0 5px">28</span>   
<span style="color: gray; padding: 0 5px 0 5px">29</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">30</span>             <span style="color: #e0eee0">controller</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">controller</span>,
<span style="color: gray; padding: 0 5px 0 5px">31</span>             <span style="color: #e0eee0">require</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;not_a&#39;</span>,
<span style="color: gray; padding: 0 5px 0 5px">32</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;EA&#39;</span>}
<span style="color: gray; padding: 0 5px 0 5px">33</span>   });
</pre></div>


<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">name</i> 参数在这里可以用以为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">controller</code> 重起一个名字，以方便在 <i style=" color: #d75100; font-style: normal; ">require</i> 参数中引用。
</p>
<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">require</i> 参数可以带两种前缀（可以同时使用）：
</p>

<ul style="line-height: 1.4em; padding: 0px; padding-left: 20px; margin: auto 30px;">
<li><i style=" color: #d75100; font-style: normal; ">?</i> ，如果指定的 controller 不存在，则忽略错误。即：
<p style="margin: 15px 0;"></p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">require</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;?not_b&#39;</span>
</pre></div>


<p style="margin: 15px 0;"></p>
如果名为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">not_b</code> 的 controller 不存在时，不会直接抛出错误， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数中对应的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">$controller</code> 为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">undefined</code> 。
<p style="margin: 15px 0;"></p>
</li>
<li><i style=" color: #d75100; font-style: normal; ">^</i> ，同时在父级节点中寻找指定的 controller ，把上面的例子小改一下：
<p style="margin: 15px 0;"></p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;a&gt;&lt;b&gt;</span>kk<span style="color: #e0eee0">&lt;/b&gt;&lt;/a&gt;</span>
</pre></div>


<p style="margin: 15px 0;"></p>
把 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">a</code> 的 <i style=" color: #d75100; font-style: normal; ">require</i> 改成（否则就找不到 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">not_a</code> 这个 controller ）：
<p style="margin: 15px 0;"></p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">require</span>: <span style="color: #00e5ee">&#39;?^not_a&#39;</span>
</pre></div>


</li>
</ul>

<p style="margin: 15px 0;">
还剩下几个模板参数：
</p>

<dl style="font-size: small; margin: 10px auto; padding: 10px; border-bottom: 1px dashed gray; border-top: 1px dashed gray;">
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">template</i> 模板内容，这个内容会根据 <i style=" color: #d75100; font-style: normal; ">replace</i> 参数的设置替换节点或只替换节点内容。</dt><dd style="margin-left: 30px;">
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">templateUrl</i> 模板内容，获取方式是异步请求。</dt><dd style="margin-left: 30px;">
</dd>
<dt style="border-left: 4px solid rgb(215, 81, 0); padding-left: 5px; margin: 5px auto;"><i style=" color: #d75100; font-style: normal; ">replace</i> 设置如何处理模板内容。为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">true</code> 时为替换掉指令节点，否则只替换到节点内容。</dt><dd style="margin-left: 30px;">
</dd>
</dl>


<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;div</span> <span style="color: #e0eee0">ng-controller=</span><span style="color: #00e5ee">&quot;TestCtrl&quot;</span><span style="color: #e0eee0">&gt;</span>
    <span style="color: #e0eee0">&lt;h1</span> <span style="color: #e0eee0">a&gt;</span>原始内容<span style="color: #e0eee0">&lt;/h1&gt;</span>
  <span style="color: #e0eee0">&lt;/div&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
    <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
    }
  
    <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
            <span style="color: #e0eee0">template</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;&lt;p&gt;标题 {{ name }} &lt;button ng-click=&quot;name=\&#39;</span><span style="color: #e0eee0">hahaha</span>\<span style="color: #00e5ee">&#39;&quot;&gt;修改&lt;/button&gt;&lt;/p&gt;&#39;</span>,
            <span style="color: #507080">//replace: true,</span>
            <span style="color: #507080">//controller: function($scope){$scope.name = &#39;xxx&#39;},</span>
            <span style="color: #507080">//scope: {},</span>
            <span style="color: #e0eee0">scope</span><span style="color: #7fff00">:</span> <span style="color: #90ee90">true</span> ,
            <span style="color: #e0eee0">controller</span><span style="color: #7fff00">:</span> <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){<span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$scope</span>)},
            <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;A&#39;</span>}
  });
  
  <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">controller</span>(<span style="color: #00e5ee">&#39;TestCtrl&#39;</span>, <span style="color: #bcd2ee">function</span>(<span style="color: #e0eee0">$scope</span>){
    <span style="color: #e0eee0">$scope</span>.<span style="color: #e0eee0">name</span> <span style="color: #7fff00">=</span> <span style="color: #00e5ee">&#39;123&#39;</span>;
    <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #e0eee0">$scope</span>);
  });
</pre></div>


<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">template</i> 中可以包括变量引用的表达式，其 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">scope</code> 遵寻 <i style=" color: #d75100; font-style: normal; ">scope</i> 参数的作用（可能受继承关系影响）。
</p>
<p style="margin: 15px 0;">
<i style=" color: #d75100; font-style: normal; ">templateUrl</i> 是异步请求模板内容，并且是获取到内容之后才开始执行指令的 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">compile</code> 函数。
</p>
<p style="margin: 15px 0;">
最后说一个 <i style=" color: #d75100; font-style: normal; ">compile</i> 这个参数。它除了可以返回一个函数用为 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数之外，还可以返回一个对象，这个对象能包括两个成员，一个 <i style=" color: #d75100; font-style: normal; ">pre</i> ，一个 <i style=" color: #d75100; font-style: normal; ">post</i> 。实际上， <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 函数是由两部分组成，所谓的 <i style=" color: #d75100; font-style: normal; ">preLink</i> 和 <i style=" color: #d75100; font-style: normal; ">postLink</i> 。区别在于执行顺序，特别是在指令层级嵌套的结构之下， <i style=" color: #d75100; font-style: normal; ">postLink</i> 是在所有的子级指令 <code style="margin: auto 3px; color: #228b22; font-family: monospace; ">link</code> 完成之后才最后执行的。 <i style=" color: #d75100; font-style: normal; ">compile</i> 如果只返回一个函数，则这个函数被作为 <i style=" color: #d75100; font-style: normal; ">postLink</i> 使用：
</p>

<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;">  <span style="color: #e0eee0">&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;</span>
</pre></div>



<div class="highlight" style="background: #103040"><pre style=" white-space: pre-wrap; word-wrap: break-word; border: 1px solid #888; font-size: small; line-height: 1.5em; padding: 5px;; color: #e0eee0; background: #103040;"><span style="color: gray; padding: 0 5px 0 5px"> 1</span>   <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">app</span> <span style="color: #7fff00">=</span> <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">module</span>(<span style="color: #00e5ee">&#39;Demo&#39;</span>, [], <span style="color: #e0eee0">angular</span>.<span style="color: #e0eee0">noop</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 2</span>   
<span style="color: gray; padding: 0 5px 0 5px"> 3</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;a&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 4</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px"> 5</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;a compile&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px"> 6</span>       <span style="color: #90ee90">return</span> {
<span style="color: gray; padding: 0 5px 0 5px"> 7</span>         <span style="color: #e0eee0">pre</span><span style="color: #7fff00">:</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;a link pre&#39;</span>)},
<span style="color: gray; padding: 0 5px 0 5px"> 8</span>         <span style="color: #e0eee0">post</span><span style="color: #7fff00">:</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;a link post&#39;</span>)},
<span style="color: gray; padding: 0 5px 0 5px"> 9</span>       }
<span style="color: gray; padding: 0 5px 0 5px">10</span>     }
<span style="color: gray; padding: 0 5px 0 5px">11</span>   
<span style="color: gray; padding: 0 5px 0 5px">12</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">13</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;E&#39;</span>}
<span style="color: gray; padding: 0 5px 0 5px">14</span>   });
<span style="color: gray; padding: 0 5px 0 5px">15</span>   
<span style="color: gray; padding: 0 5px 0 5px">16</span>   <span style="color: #e0eee0">app</span>.<span style="color: #e0eee0">directive</span>(<span style="color: #00e5ee">&#39;b&#39;</span>, <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px">17</span>     <span style="color: #bcd2ee">var</span> <span style="color: #e0eee0">func</span> <span style="color: #7fff00">=</span> <span style="color: #bcd2ee">function</span>(){
<span style="color: gray; padding: 0 5px 0 5px">18</span>       <span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;b compile&#39;</span>);
<span style="color: gray; padding: 0 5px 0 5px">19</span>       <span style="color: #90ee90">return</span> {
<span style="color: gray; padding: 0 5px 0 5px">20</span>         <span style="color: #e0eee0">pre</span><span style="color: #7fff00">:</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;b link pre&#39;</span>)},
<span style="color: gray; padding: 0 5px 0 5px">21</span>         <span style="color: #e0eee0">post</span><span style="color: #7fff00">:</span> <span style="color: #bcd2ee">function</span>(){<span style="color: #e0eee0">console</span>.<span style="color: #e0eee0">log</span>(<span style="color: #00e5ee">&#39;b link post&#39;</span>)},
<span style="color: gray; padding: 0 5px 0 5px">22</span>       }
<span style="color: gray; padding: 0 5px 0 5px">23</span>     }
<span style="color: gray; padding: 0 5px 0 5px">24</span>   
<span style="color: gray; padding: 0 5px 0 5px">25</span>     <span style="color: #90ee90">return</span> {<span style="color: #e0eee0">compile</span><span style="color: #7fff00">:</span> <span style="color: #e0eee0">func</span>,
<span style="color: gray; padding: 0 5px 0 5px">26</span>             <span style="color: #e0eee0">restrict</span><span style="color: #7fff00">:</span> <span style="color: #00e5ee">&#39;E&#39;</span>}
<span style="color: gray; padding: 0 5px 0 5px">27</span>   });
</pre></div>
